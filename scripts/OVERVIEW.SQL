------------------------------------------------------------------------------------------------------------------------------------------------
--CONSULTA A = TOTAL VENDIDO NO DIA, MÊS E ANO
-- DIA, MÊS E ANO ESPECÍFICOS
SELECT DIA, CASE MES
    WHEN 1 THEN 'JANEIRO'
    WHEN 2 THEN 'FEVEREIRO'
    WHEN 3 THEN 'MARCO'
    WHEN 4 THEN 'ABRIL'
    WHEN 5 THEN 'MAIO'
    WHEN 6 THEN 'JUNHO'
    WHEN 7 THEN 'JULHO'
    WHEN 8 THEN 'AGOSTO'
    WHEN 9 THEN 'SETEMBRO'
    WHEN 10 THEN 'OUTUBRO'
    WHEN 11 THEN 'NOVEMBRO'
    WHEN 12 THEN 'DEZEMBRO' END AS MES, ANO, VALOR_TOTAL FROM
    (SELECT EXTRACT(DAY FROM DATA_VENDA) AS DIA, EXTRACT(MONTH FROM DATA_VENDA) AS MES, EXTRACT(YEAR FROM DATA_VENDA) AS ANO, SUM(TOTAL) AS VALOR_TOTAL
    FROM VENDA
        WHERE EXTRACT(DAY FROM DATA_VENDA) = '08' AND EXTRACT(MONTH FROM DATA_VENDA) = '01' AND EXTRACT(YEAR FROM DATA_VENDA) = '2015'
        GROUP BY EXTRACT(DAY FROM DATA_VENDA), EXTRACT(MONTH FROM DATA_VENDA), EXTRACT(YEAR FROM DATA_VENDA));
    
-- MÊS E ANO ESPECÍFICOS
SELECT CASE MES
    WHEN 1 THEN 'JANEIRO'
    WHEN 2 THEN 'FEVEREIRO'
    WHEN 3 THEN 'MARCO'
    WHEN 4 THEN 'ABRIL'
    WHEN 5 THEN 'MAIO'
    WHEN 6 THEN 'JUNHO'
    WHEN 7 THEN 'JULHO'
    WHEN 8 THEN 'AGOSTO'
    WHEN 9 THEN 'SETEMBRO'
    WHEN 10 THEN 'OUTUBRO'
    WHEN 11 THEN 'NOVEMBRO'
    WHEN 12 THEN 'DEZEMBRO' END AS MES, ANO, VALOR_TOTAL FROM
    (SELECT EXTRACT(MONTH FROM DATA_VENDA) AS MES, EXTRACT(YEAR FROM DATA_VENDA) AS ANO, SUM(TOTAL) AS VALOR_TOTAL
    FROM VENDA
        WHERE EXTRACT(MONTH FROM DATA_VENDA) = '04' AND EXTRACT(YEAR FROM DATA_VENDA) = '2014'
        GROUP BY EXTRACT(MONTH FROM DATA_VENDA), EXTRACT(YEAR FROM DATA_VENDA));

--ANO ESPECÍFICO
SELECT EXTRACT(YEAR FROM DATA_VENDA) AS ANO, SUM(TOTAL) AS VALOR_TOTAL
    FROM VENDA
    WHERE EXTRACT(YEAR FROM DATA_VENDA) = '2014'
    GROUP BY EXTRACT(YEAR FROM DATA_VENDA);
    
--**DIA: NÃO FIZ UMA CONSULTA UNICAMENTE POR DIA PORQUE PARA MIM NÃO FAZ SENTIDO UMA CONSULTA DESSA FORMA    
--**MES: NÃO FIZ UMA CONSULTA UNICAMENTE POR MÊS PORQUE PARA MIM NÃO FAZ SENTIDO UMA CONSULTA DESSA FORMA

------------------------------------------------------------------------------------------------------------------------------------------------

--CONSULTA B - TOP-3 FUNCIONARIOS QUE MAIS VENDERAM NO MES E NO ANO
--SEM FILTRO
SELECT * FROM
    (SELECT P.NOME AS NOME, EXTRACT(MONTH FROM DATA_VENDA) AS MES, EXTRACT(YEAR FROM DATA_VENDA) AS ANO, COUNT(*) AS NUMVENDAS
        FROM VENDEDOR V
        JOIN PESSOA P ON V.ID_PESSOA = P.ID_PESSOA
        JOIN VENDA VD ON V.ID_PESSOA = VD.ID_VENDEDOR
        GROUP BY V.ID_PESSOA, P.NOME, P.ID_PESSOA, EXTRACT(MONTH FROM DATA_VENDA), EXTRACT(YEAR FROM DATA_VENDA)
        ORDER BY COUNT(*) DESC)
    WHERE ROWNUM <= 3;
    
--COM FILTRO
SELECT * FROM
    (SELECT P.NOME AS NOME, EXTRACT(MONTH FROM DATA_VENDA) AS MES, EXTRACT(YEAR FROM DATA_VENDA) AS ANO, COUNT(*) AS NUMVENDAS
        FROM VENDEDOR V
        JOIN PESSOA P ON V.ID_PESSOA = P.ID_PESSOA
        JOIN VENDA VD ON V.ID_PESSOA = VD.ID_VENDEDOR
        WHERE EXTRACT(MONTH FROM DATA_VENDA) = '11' AND EXTRACT(YEAR FROM DATA_VENDA) = '2018' 
        GROUP BY V.ID_PESSOA, P.NOME, P.ID_PESSOA, EXTRACT(MONTH FROM DATA_VENDA), EXTRACT(YEAR FROM DATA_VENDA)
        ORDER BY COUNT(*) DESC)
    WHERE ROWNUM <= 3;

------------------------------------------------------------------------------------------------------------------------------------------------

--CONSULTA C - TOP-15 PRODUTOS MAIS VENDIDOS, JUNTAMENTE COM A QUANTIDADE
SELECT * FROM
    (SELECT P.NOME AS NOME, COUNT(*) AS NUMVENDAS
        FROM ITEMVENDA I
        JOIN VENDA V ON I.ID_VENDA = V.ID_VENDA
        JOIN PRODUTO P ON I.ID_PRODUTO = P.ID_PRODUTO
        GROUP BY P.NOME
        ORDER BY COUNT(*) DESC)
    WHERE ROWNUM <= 15;
    
------------------------------------------------------------------------------------------------------------------------------------------------

--CONSULTA D - CLIENTES QUE MAIS COMPRARAM NO ANO
--com filtro 
SELECT P.NOME AS NOME_CLIENTE, EXTRACT(YEAR FROM V.DATA_VENDA) AS ANO, COUNT(*) AS NUMCOMPRAS
    FROM CLIENTE C
    JOIN PESSOA P ON C.ID_PESSOA = P.ID_PESSOA
    JOIN VENDA V ON C.ID_CLIENTE = V.ID_CLIENTE
    WHERE EXTRACT(YEAR FROM V.DATA_VENDA) = '2018'
    GROUP BY P.NOME, EXTRACT(YEAR FROM V.DATA_VENDA)
    ORDER BY COUNT(*) DESC;

------------------------------------------------------------------------------------------------------------------------------------------------

--CONSULTA E - CLIENTES QUE MAIS COMPRARAM
SELECT P.NOME AS NOME_CLIENTE, COUNT(*) AS NUMCOMPRAS
    FROM CLIENTE C
    JOIN PESSOA P ON C.ID_PESSOA = P.ID_PESSOA
    JOIN VENDA V ON C.ID_CLIENTE = V.ID_CLIENTE
    GROUP BY P.NOME
    ORDER BY COUNT(*) DESC;

------------------------------------------------------------------------------------------------------------------------------------------------

--CONSULTA F - NOME E QTD DOS PRODUTOS CUJO ESTOQUE É MENOR QUE 10
SELECT NOME AS NOME_PRODUTO, QUANTIDADE AS QTD_PRODUTO
    FROM PRODUTO
    WHERE QUANTIDADE < 10
    ORDER BY QUANTIDADE DESC;

------------------------------------------------------------------------------------------------------------------------------------------------

--CONSULTA H - GRAFICO QUE MOSTRA O TOTAL VENDIDO POR ANO
SELECT CASE MES
    WHEN 1 THEN 'JANEIRO'
    WHEN 2 THEN 'FEVEREIRO'
    WHEN 3 THEN 'MARCO'
    WHEN 4 THEN 'ABRIL'
    WHEN 5 THEN 'MAIO'
    WHEN 6 THEN 'JUNHO'
    WHEN 7 THEN 'JULHO'
    WHEN 8 THEN 'AGOSTO'
    WHEN 9 THEN 'SETEMBRO'
    WHEN 10 THEN 'OUTUBRO'
    WHEN 11 THEN 'NOVEMBRO'
    WHEN 12 THEN 'DEZEMBRO' END AS MES, TOTAL FROM
    (SELECT EXTRACT(MONTH FROM DATA_VENDA) AS MES, SUM(TOTAL) AS TOTAL FROM VENDA
        WHERE EXTRACT(YEAR FROM DATA_VENDA) = '2014'
        GROUP BY EXTRACT(MONTH FROM DATA_VENDA)
        ORDER BY EXTRACT(MONTH FROM DATA_VENDA) ASC);

------------------------------------------------------------------------------------------------------------------------------------------------

--CONSULTA G - GRAFICO QUE MOSTRA O TOTAL VENDIDO POR MES DO ANO QUE O USUARIO INDICA
SELECT EXTRACT(YEAR FROM DATA_VENDA) AS ANO, SUM(TOTAL) AS TOTAL FROM VENDA
    WHERE (EXTRACT(YEAR FROM DATA_VENDA)>=2014 AND EXTRACT(YEAR FROM DATA_VENDA)<=2018)
    GROUP BY EXTRACT(YEAR FROM DATA_VENDA)
    ORDER BY EXTRACT(YEAR FROM DATA_VENDA);

COMMIT;
